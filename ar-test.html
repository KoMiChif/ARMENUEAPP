<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR 能力检测</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .check-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #ddd;
        }
        
        .check-item.success {
            border-left-color: #4caf50;
            background: #f1f8f4;
        }
        
        .check-item.error {
            border-left-color: #f44336;
            background: #fef1f0;
        }
        
        .check-item.warning {
            border-left-color: #ff9800;
            background: #fff8f0;
        }
        
        .check-title {
            font-weight: bold;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .check-detail {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .icon {
            font-size: 20px;
        }
        
        button {
            width: 100%;
            padding: 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading {
            text-align: center;
            color: #667eea;
            margin: 20px 0;
        }
        
        .summary {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: center;
        }
        
        .summary.good {
            background: #4caf50;
        }
        
        .summary.bad {
            background: #f44336;
        }
        
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
            color: #e83e8c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📱 AR 能力检测工具</h1>
        <p class="subtitle">检查你的设备是否支持 WebXR AR 功能</p>
        
        <div id="results"></div>
        
        <button id="testBtn" onclick="runTests()">开始检测</button>
        
        <div id="summary" style="display: none;"></div>
    </div>

    <script>
        const results = document.getElementById('results');
        const summaryDiv = document.getElementById('summary');
        const testBtn = document.getElementById('testBtn');
        
        function addCheckItem(title, detail, status) {
            const item = document.createElement('div');
            item.className = `check-item ${status}`;
            
            const icons = {
                success: '✅',
                error: '❌',
                warning: '⚠️'
            };
            
            item.innerHTML = `
                <div class="check-title">
                    <span class="icon">${icons[status]}</span>
                    ${title}
                </div>
                <div class="check-detail">${detail}</div>
            `;
            
            results.appendChild(item);
        }
        
        async function runTests() {
            results.innerHTML = '<div class="loading">🔍 检测中...</div>';
            testBtn.disabled = true;
            summaryDiv.style.display = 'none';
            
            // 等待一下让界面更新
            await new Promise(resolve => setTimeout(resolve, 500));
            
            results.innerHTML = '';
            let passCount = 0;
            let totalTests = 0;
            
            // 测试 1: HTTPS 检测
            totalTests++;
            const isHttps = window.location.protocol === 'https:';
            if (isHttps) {
                addCheckItem(
                    'HTTPS 连接',
                    '✨ 太棒了！你正在使用安全的 HTTPS 连接，这是 WebXR 的必要条件。',
                    'success'
                );
                passCount++;
            } else {
                addCheckItem(
                    'HTTPS 连接',
                    `⛔ 当前使用 HTTP 连接（${window.location.protocol}）。WebXR 需要 HTTPS 才能工作。<br><br>
                    <strong>解决方案：</strong><br>
                    • 使用 ngrok 获取 HTTPS 链接<br>
                    • 部署到支持 HTTPS 的服务器（如 GitHub Pages、Vercel）`,
                    'error'
                );
            }
            
            // 测试 2: 浏览器支持
            totalTests++;
            const userAgent = navigator.userAgent;
            const isChrome = /Chrome/.test(userAgent) && /Google Inc/.test(navigator.vendor);
            const isSafari = /Safari/.test(userAgent) && /Apple Computer/.test(navigator.vendor);
            const isEdge = /Edg/.test(userAgent);
            
            let browserSupport = false;
            let browserMsg = '';
            
            if (isChrome || isEdge) {
                browserSupport = true;
                browserMsg = `检测到 Chrome/Edge 浏览器，完美支持 WebXR！`;
                passCount++;
            } else if (isSafari) {
                const iosVersion = userAgent.match(/OS (\d+)_/);
                if (iosVersion && parseInt(iosVersion[1]) >= 17) {
                    browserSupport = true;
                    browserMsg = `检测到 iOS ${iosVersion[1]}+ Safari，支持 WebXR！`;
                    passCount++;
                } else {
                    browserMsg = `检测到 Safari 浏览器，但需要 iOS 17.4+ 才支持 WebXR。<br>当前版本：${iosVersion ? iosVersion[1] : '未知'}`;
                }
            } else {
                browserMsg = `当前浏览器可能不支持 WebXR。<br>建议使用：Chrome、Edge 或 iOS 17.4+ Safari`;
            }
            
            addCheckItem(
                '浏览器兼容性',
                browserMsg,
                browserSupport ? 'success' : 'error'
            );
            
            // 测试 3: WebXR API 检测
            totalTests++;
            if ('xr' in navigator) {
                addCheckItem(
                    'WebXR API',
                    '🎉 你的浏览器支持 WebXR API！这是运行 AR 应用的基础。',
                    'success'
                );
                passCount++;
                
                // 测试 4: AR 模式支持
                totalTests++;
                try {
                    const supported = await navigator.xr.isSessionSupported('immersive-ar');
                    if (supported) {
                        addCheckItem(
                            'AR 模式支持',
                            '🚀 完美！你的设备支持沉浸式 AR 体验（immersive-ar）。可以开始开发 AR 应用了！',
                            'success'
                        );
                        passCount++;
                    } else {
                        addCheckItem(
                            'AR 模式支持',
                            '设备不支持沉浸式 AR 模式。可能原因：<br>• 设备硬件不支持<br>• 需要授予相机权限<br>• 传感器未就绪',
                            'warning'
                        );
                    }
                } catch (error) {
                    addCheckItem(
                        'AR 模式支持',
                        `检测 AR 支持时出错：${error.message}<br><br>这通常是因为缺少 HTTPS 连接。`,
                        'error'
                    );
                }
                
                // 测试 5: VR 模式支持（额外信息）
                totalTests++;
                try {
                    const vrSupported = await navigator.xr.isSessionSupported('immersive-vr');
                    if (vrSupported) {
                        addCheckItem(
                            'VR 模式支持（额外）',
                            '🥽 你的设备也支持 VR 模式！',
                            'success'
                        );
                        passCount++;
                    } else {
                        addCheckItem(
                            'VR 模式支持（额外）',
                            'VR 模式不可用（这对 AR 项目不影响）',
                            'warning'
                        );
                    }
                } catch (error) {
                    addCheckItem(
                        'VR 模式支持（额外）',
                        'VR 模式检测失败（对 AR 项目无影响）',
                        'warning'
                    );
                }
            } else {
                addCheckItem(
                    'WebXR API',
                    '❌ 浏览器不支持 WebXR API。<br><br><strong>原因可能是：</strong><br>• 浏览器版本太旧<br>• 不是支持的浏览器<br>• 需要在 HTTPS 下才能访问',
                    'error'
                );
            }
            
            // 测试 6: 设备信息
            totalTests++;
            const deviceInfo = [];
            deviceInfo.push(`屏幕: ${window.screen.width}×${window.screen.height}`);
            deviceInfo.push(`设备像素比: ${window.devicePixelRatio}`);
            deviceInfo.push(`触摸支持: ${('ontouchstart' in window) ? '是' : '否'}`);
            
            addCheckItem(
                '设备信息',
                deviceInfo.join('<br>'),
                'success'
            );
            passCount++;
            
            // 显示总结
            summaryDiv.style.display = 'block';
            const percentage = Math.round((passCount / totalTests) * 100);
            let summaryClass = 'summary';
            let summaryText = '';
            
            if (percentage >= 80) {
                summaryClass += ' good';
                summaryText = `🎊 太棒了！检测通过 ${passCount}/${totalTests} 项<br><br>你的设备已准备好开发 WebXR AR 应用！`;
            } else if (percentage >= 50) {
                summaryClass += ' warning';
                summaryText = `⚠️ 检测通过 ${passCount}/${totalTests} 项<br><br>部分功能可用，但需要解决上述问题才能完整体验 AR。`;
            } else {
                summaryClass += ' bad';
                summaryText = `😔 检测通过 ${passCount}/${totalTests} 项<br><br>当前环境不太适合 WebXR 开发，请先解决上述关键问题。`;
            }
            
            summaryDiv.className = summaryClass;
            summaryDiv.innerHTML = summaryText;
            
            testBtn.disabled = false;
            testBtn.textContent = '重新检测';
        }
        
        // 页面加载时自动运行检测
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>